---
title: "R2"
author: "Lofty"
date: '2022-06-01'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
#https://github.com/cl0fty/R2.git
#Webscraping attempt1
#https://www.rstudio.com/blog/rvest-easy-web-scraping-with-r/

#install.packages("rvest")
library(rvest)
#install.packages(“xml2”)
library(xml2)

redfin <- 
  read_html("https://www.redfin.com/minorcivildivision/327/CT/Cheshire/filter/property-type=house,min-price=200k,max-price=500k,min-beds=2,min-baths=1,include=sold-1yr")
redfin

redfin %>%
html_elements(".homecardV2Price",) %>%  #html_nodes deprecated
html_text() %>%
redfin
  
#need to clean it still
##################################
#Part 2 - trying the DL link. Is there an API to learn to work with?
maxprice <- "500000"  #trying to make vars of settings like max and min prices
minprice <- "200000"
url <- paste("https://www.redfin.com/stingray/api/gis-csv?al=1&has_dishwasher=false&has_laundry_facility=false&has_laundry_hookups=false&has_parking=false&has_pool=false&has_short_term_lease=false&include_pending_homes=false&isRentals=false&is_furnished=false&market=connecticut&max_price=", maxprice,"&min_price=", minprice, "&num_baths=1&num_beds=2&num_homes=350&ord=redfin-recommended-asc&page_number=1&region_id=327&region_type=10&sold_within_days=365&status=9&travel_with_traffic=false&travel_within_region=false&uipt=1&utilities_included=false&v=8", sep = "")
# Specify destination where file should be saved
destfile <- "C:/Users/lofti/Documents/R/Learning/output.csv"
# Apply download.file function in R
download.file(url, destfile, mode="wb")
#  && Sys.Date() 

```

